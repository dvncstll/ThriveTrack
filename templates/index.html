<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inventory Admin Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --bg: #f4f7f8;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --line: #e5e7eb;
      --teal-50:#e6fbf7; --teal-200:#b7d7d2; --teal-600:#2c6d62;
      --green-50:#ecfdf5; --green-600:#059669;
      --cyan-50:#e6fafe; --cyan-600:#0891b2;
      --amber-50:#fff7ed; --amber-600:#d97706;
      --rose-50:#fef2f2; --rose-600:#dc2626;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    }
    .shell {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr;
    }
    @media (min-width: 960px) {
      .shell { grid-template-columns: 260px minmax(0,1fr); }
    }

    /* Sidebar */
    .sidebar {
      display: none;
    }
    @media (min-width: 960px) {
      .sidebar {
        display: flex;
        position: sticky; top: 0; height: 100vh;
        flex-direction: column; gap: 14px;
        background: var(--card);
        border-right: 1px solid var(--line);
        padding: 16px;
      }
    }
    .profile {
      display: flex; gap: 12px; align-items: center;
      background: #f8fafc; border-radius: 16px; padding: 12px;
    }
    .avatar { width: 40px; height: 40px; border-radius: 999px; background: linear-gradient(135deg,#14b8a6,#0f766e); }
    .muted { color: var(--muted); }
    .nav button {
      width: 100%; text-align: left;
      padding: 10px 12px; border: 0; background: transparent; cursor: pointer;
      border-radius: 12px; color: #0f172a; font-size: 14px;
    }
    .nav button:hover { background: #f8fafc; }
    .nav button.active { background: #eef2f7; font-weight: 600; }
    .nav .nav-link {
      width: 100%; text-align: left;
      padding: 10px 12px; border: 0; background: transparent; cursor: pointer;
      border-radius: 12px; color: #0f172a; font-size: 14px;
      text-decoration: none; display: block; transition: all 0.2s;
    }
    .nav .nav-link:hover { background: #f8fafc; }
    .nav .nav-link.active { background: #eef2f7; font-weight: 600; }
    .logout {
      margin-top: auto; width: 100%; border: 1px solid var(--line); background: #fff;
      padding: 10px 12px; border-radius: 12px; cursor: pointer;
    }

    /* Main */
    main { padding: 16px; }
    @media (min-width: 960px) { main { padding: 32px; } }

    .topbar { display: grid; gap: 12px; }
    @media (min-width: 960px) {
      .topbar { grid-template-columns: 1fr auto; align-items: center; }
    }
    
    /* Announcement Preview Sidebar */
    .preview-sidebar {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 300px;
      max-height: 400px;
      background: white;
      border: 1px solid var(--line);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      z-index: 100;
      overflow: hidden;
    }
    
    .preview-sidebar-header {
      background: var(--teal-600);
      color: white;
      padding: 12px 16px;
      font-weight: 600;
      font-size: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .preview-sidebar-content {
      padding: 16px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .preview-sidebar-actions {
      padding: 12px 16px;
      border-top: 1px solid var(--line);
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }
    
    @media (max-width: 1200px) {
      .preview-sidebar {
        display: none;
      }
    }
    h1 { margin: 0; font-size: 24px; }
    .searchbar { position: relative; }
    .searchbar input {
      width: min(560px, 100%);
      padding: 10px 12px 10px 36px; border-radius: 16px;
      border: 1px solid var(--line); background: var(--card);
      outline: none; font-size: 14px; box-shadow: 0 1px 2px rgba(0,0,0,.04);
    }
    .icon { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); opacity:.5 }
    .toolbar { display: flex; gap: 8px; }
    .iconbtn { border: 1px solid var(--line); background: var(--card); padding: 8px; border-radius: 12px; cursor: pointer; }

    /* Cards */
    .grid { display: grid; gap: 16px; }
    .grid.cols-4 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
    @media (min-width: 640px) { .grid.cols-4 { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
    @media (min-width: 1024px) { .grid.cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); } }

    .stat {
      border: 1px solid var(--line); border-radius: 16px; padding: 14px; box-shadow: 0 1px 2px rgba(0,0,0,.04);
      display: grid; grid-template-columns: auto 1fr; align-items: center; gap: 10px;
    }
    .tone-teal { background: var(--teal-50); color: #0b3b35; }
    .tone-green { background: var(--green-50); color: #064e3b; }
    .tone-cyan { background: var(--cyan-50); color: #083344; }
    .tone-amber { background: var(--amber-50); color: #7c2d12; }
    .stat .value { font-size: 24px; font-weight: 700; text-align: right; }
    .stat .label { font-size: 12px; opacity: .7; text-align: right; }

    .card { background: var(--card); border: 1px solid var(--line); border-radius: 16px; padding: 16px; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
    .card h3 { margin: 0 0 10px; font-size: 14px; font-weight: 600; }

    .middle { grid-template-columns: 1fr; }
    @media (min-width: 1024px) { .middle { grid-template-columns: 1fr 1fr 1.2fr; } }

    .row { display: flex; align-items: center; justify-content: space-between; gap: 8px; }

    .progress { height: 8px; width: 100%; background: #f1f5f9; border-radius: 999px; overflow: hidden; }
    .progress > span { display: block; height: 100%; background: #94a3b8; }

    .chart-wrap { height: 260px; }
    .chart-legend { display: flex; gap: 16px; align-items: center; font-size: 12px; color: var(--muted); }
    .dot { width: 10px; height: 10px; border-radius: 2px; display: inline-block; }

    .footer-note { font-size: 12px; color: var(--muted); }

    /* New: Insights grids and badges */
    .insights-2 { grid-template-columns: 1fr; }
    @media (min-width: 1024px) { .insights-2 { grid-template-columns: 1fr 1fr; } }

    .badge { font-size: 12px; padding: 4px 8px; border-radius: 999px; border: 1px solid var(--line); }
    .risk-high { background: var(--rose-50); color: #991b1b; border-color: #fecaca; }
    .risk-medium { background: var(--amber-50); color: #7c2d12; border-color: #fed7aa; }
    .risk-low { background: var(--green-50); color: #065f46; border-color: #bbf7d0; }

    /* New component styles */
    .report-btn {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      padding: 12px;
      border: 1px solid var(--line);
      background: var(--card);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
    }
    .report-btn:hover {
      background: #f8fafc;
      border-color: var(--teal-200);
    }
    .format-badge {
      background: var(--teal-50);
      color: var(--teal-600);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
    }
    .risk-factor {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background: #f8fafc;
      border-radius: 6px;
      font-size: 13px;
    }
    .announcement-item {
      padding: 12px;
      background: #f8fafc;
      border-radius: 8px;
      border-left: 3px solid var(--teal-600);
    }
    .announcement-item.urgent {
      border-left-color: var(--rose-600);
      background: var(--rose-50);
    }
    .announcement-title {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 13px;
    }
    .announcement-meta {
      font-size: 11px;
      color: var(--muted);
    }
    .download-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background: #f8fafc;
      border-radius: 6px;
      font-size: 13px;
    }

    /* Spinner animation */
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }


  </style>
</head>
<body>
  <div class="shell">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="profile">
        <div class="avatar"></div>
        <div>
          <div style="font-weight:600" id="userName">Nirmal Kumar P</div>
          <div class="muted" style="font-size:12px" id="userEmail">nirmalcom.job@gmail.com</div>
        </div>
      </div>

      <nav class="nav">
        <a href="/" class="nav-link active">Dashboard</a>
        <a href="/hr-inventory" class="nav-link">Inventory</a>
        <a href="/hr-orders" class="nav-link">Orders</a>
        <a href="/hr-purchase" class="nav-link">Purchase</a>
        <a href="/hr-reporting" class="nav-link">Reporting</a>
        <a href="/hr-support" class="nav-link">Support</a>
        <a href="/hr-settings" class="nav-link">Settings</a>
      </nav>

      <button class="logout" id="logoutBtn">Logout</button>
    </aside>

    <!-- Main -->
    <main>
      <!-- Top bar -->
      <div class="topbar">
        <h1>Welcome Nirmal!</h1>
        <div class="row">
          <div class="searchbar">
            <svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            <input type="text" placeholder="Search" />
          </div>
          <div class="toolbar">
            <button class="iconbtn" title="Notifications">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8a6 6 0 0 0-12 0c0 7-3 5-3 7h18c0-2-3 0-3-7"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
            </button>
            <button class="iconbtn" title="Settings">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 8 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 3.6 15a1.65 1.65 0 0 0-1.51-1H2a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 3.6 8a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 8 3.6a1.65 1.65 0 0 0 1-1.51V2a2 2 0 1 1 4 0v.09A1.65 1.65 0 0 0 15 3.6a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l.06.06A1.65 1.65 0 0 0 20.4 8c.36.61.57 1.32.6 2.05V10a2 2 0 1 1 0 4h-.09c-.03.73-.24 1.44-.51 2.05z"/></svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Announcement Preview Sidebar -->
      <div class="preview-sidebar">
        <div class="preview-sidebar-header">
          <span>Announcement Preview</span>
          <button id="closePreviewSidebar" style="background:none; border:0; color:white; cursor:pointer; font-size:16px;">&times;</button>
        </div>
        <div class="preview-sidebar-content" id="previewContent">
          <div style="text-align:center; color:var(--muted); font-style:italic; padding:20px;">
            Preview content will appear here when you click "Preview"
          </div>
        </div>
        <div class="preview-sidebar-actions">
          <button id="editPreviewSidebar" style="background:var(--muted); color:white; border:0; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:12px;">Edit</button>
          <button id="sendFromPreviewSidebar" style="background:var(--teal-600); color:white; border:0; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:12px;">Send Now</button>
        </div>
      </div>

      <!-- Overview cards -->
      <section class="grid cols-4" style="margin-top:16px">
        <div class="stat tone-teal">
          <div style="background:#fff; padding:8px; border-radius:12px; box-shadow:0 1px 2px rgba(0,0,0,.06);">üì¶</div>
          <div>
            <div class="value">5,483</div>
            <div class="label">Total Products</div>
          </div>
        </div>
        <div class="stat tone-green">
          <div style="background:#fff; padding:8px; border-radius:12px; box-shadow:0 1px 2px rgba(0,0,0,.06);">üõí</div>
          <div>
            <div class="value">2,859</div>
            <div class="label">Orders</div>
          </div>
        </div>
        <div class="stat tone-cyan">
          <div style="background:#fff; padding:8px; border-radius:12px; box-shadow:0 1px 2px rgba(0,0,0,.06);">üìö</div>
          <div>
            <div class="value">5,483</div>
            <div class="label">Total Stock</div>
          </div>
        </div>
        <div class="stat tone-amber">
          <div style="background:#fff; padding:8px; border-radius:12px; box-shadow:0 1px 2px rgba(0,0,0,.06);">‚ö†Ô∏è</div>
          <div>
            <div class="value">38</div>
            <div class="label">Out of Stock</div>
          </div>
        </div>
      </section>

      <!-- Middle Row -->
      <section class="grid middle" style="margin-top:16px">
        <div class="card">
          <div class="row" style="margin-bottom:8px"><h3>Stress Factors Breakdown</h3><button class="iconbtn" aria-label="more">‚ãÆ</button></div>
          <div class="chart-wrap"><canvas id="stressBar"></canvas></div>
        </div>

        <div class="card">
          <div class="row" style="margin-bottom:8px"><h3>Anonymous Team Sentiment</h3><span class="footer-note">Aggregated and privacy-safe</span></div>
          <div class="chart-wrap"><canvas id="sentimentChart"></canvas></div>
          <div class="row" style="margin-top:8px"><span class="muted">Overall Score</span><strong id="sentimentScore" style="margin-left:auto">-</strong></div>
        </div>

        <div class="card">
          <div class="row" style="margin-bottom:8px"><h3>Burnout Risk Alerts</h3><span class="footer-note">Early indicators</span></div>
          <div id="burnoutList" style="display:grid; gap:12px"></div>
        </div>
      </section>

      <!-- Well-being Trends (Main) -->
      <section class="card" style="margin-top:16px">
        <div class="row" style="margin-bottom:6px"><h3>Well-being Trends</h3><span class="footer-note">Productivity vs Well-being</span></div>
        <div class="chart-wrap"><canvas id="wellbeingChart"></canvas></div>
      </section>

      <!-- Attrition Risk Prediction -->
      <section class="card" style="margin-top:16px; border: 2px solid #ff0000;">
        <div class="row" style="margin-bottom:16px">
          <h3>Attrition Risk Prediction</h3>
          <span class="footer-note">AI-powered early warning system</span>
        </div>
        <div class="grid insights-2" style="gap:20px">
          <div>
            <h4 style="margin:0 0 12px; font-size:13px; color:var(--muted)">Risk Factors Analysis</h4>
            <div id="riskFactors" style="display:grid; gap:8px; min-height:100px; background:#f0f0f0; padding:10px; border-radius:8px;"></div>
            <button id="addRiskFactor" style="margin-top:12px; background:var(--teal-600); color:white; border:0; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:12px;">+ Add Risk Factor</button>
          </div>
          <div>
            <h4 style="margin:0 0 12px; font-size:13px; color:var(--muted)">High Risk Employees</h4>
            <div id="highRiskEmployees" style="display:grid; gap:8px; min-height:100px; background:#f0f0f0; padding:10px; border-radius:8px;"></div>
            <button id="addEmployee" style="margin-top:12px; background:var(--rose-600); color:white; border:0; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:12px;">+ Add Employee</button>
          </div>
        </div>
        
        <!-- Risk Assessment Form -->
        <div id="riskAssessmentForm" style="display:none; margin-top:20px; padding:16px; background:#f8fafc; border-radius:8px; border:1px solid var(--line);">
          <h4 style="margin:0 0 12px; font-size:14px;">Quick Risk Assessment</h4>
          <div style="display:grid; gap:12px;">
            <div>
              <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:4px;">Employee Name:</label>
              <input type="text" id="employeeName" placeholder="Enter employee name" style="width:100%; padding:8px; border:1px solid var(--line); border-radius:6px; font-size:14px;">
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
              <div>
                <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:4px;">Workload Level:</label>
                <select id="workloadLevel" style="width:100%; padding:8px; border:1px solid var(--line); border-radius:6px; font-size:14px;">
                  <option value="low">Low</option>
                  <option value="medium">Medium</option>
                  <option value="high">High</option>
                  <option value="critical">Critical</option>
                </select>
              </div>
              <div>
                <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:4px;">Mood Score:</label>
                <select id="moodScore" style="width:100%; padding:8px; border:1px solid var(--line); border-radius:6px; font-size:14px;">
                  <option value="9">9-10 (Excellent)</option>
                  <option value="7">7-8 (Good)</option>
                  <option value="5">5-6 (Average)</option>
                  <option value="3">3-4 (Poor)</option>
                  <option value="1">1-2 (Very Poor)</option>
                </select>
              </div>
            </div>
            <div style="display:flex; gap:8px;">
              <button id="calculateRisk" style="background:var(--teal-600); color:white; border:0; padding:10px 20px; border-radius:6px; cursor:pointer; font-weight:500;">Calculate Risk</button>
              <button id="cancelAssessment" style="background:var(--muted); color:white; border:0; padding:10px 20px; border-radius:6px; cursor:pointer;">Cancel</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Downloadable Reports -->
      <section class="card" style="margin-top:16px; border: 2px solid #00ff00;">
        <div class="row" style="margin-bottom:16px">
          <h3>Downloadable Reports</h3>
          <span class="footer-note">Export data in multiple formats</span>
        </div>
        <div class="grid insights-2" style="gap:20px">
          <div>
            <h4 style="margin:0 0 12px; font-size:13px; color:var(--muted)">Report Types</h4>
            <div style="display:grid; gap:8px">
              <button class="report-btn" data-type="wellbeing" data-format="pdf">
                <span>üìä Well-being Summary</span>
                <span class="format-badge">PDF</span>
              </button>
              <button class="report-btn" data-type="productivity" data-format="csv">
                <span>üìà Productivity Metrics</span>
                <span class="format-badge">CSV</span>
              </button>
              <button class="report-btn" data-type="attrition" data-format="pdf">
                <span>‚ö†Ô∏è Attrition Risk Report</span>
                <span class="format-badge">PDF</span>
              </button>
              <button class="report-btn" data-type="team" data-format="csv">
                <span>üë• Team Performance</span>
                <span class="format-badge">CSV</span>
              </button>
            </div>
            
            <!-- Report Generation Progress -->
            <div id="reportProgress" style="display:none; margin-top:16px; padding:12px; background:#f0f9ff; border-radius:8px; border:1px solid #0ea5e9;">
              <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
                <div style="width:16px; height:16px; border:2px solid #0ea5e9; border-top:2px solid transparent; border-radius:50%; animation:spin 1s linear infinite;"></div>
                <span style="font-size:13px; color:#0c4a6e;">Generating report...</span>
              </div>
              <div class="progress" style="height:6px;">
                <span id="progressBar" style="width:0%; background:#0ea5e9; transition:width 0.3s;"></span>
              </div>
            </div>
          </div>
          <div>
            <h4 style="margin:0 0 12px; font-size:13px; color:var(--muted)">Recent Downloads</h4>
            <div id="recentDownloads" style="display:grid; gap:8px; min-height:100px; background:#f0f0f0; padding:10px; border-radius:8px;"></div>
            <button id="clearDownloads" style="margin-top:12px; background:var(--muted); color:white; border:0; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:12px;">Clear History</button>
          </div>
        </div>
        
        <!-- Report Customization -->
        <div style="margin-top:20px; padding:16px; background:#f8fafc; border-radius:8px; border:1px solid var(--line);">
          <h4 style="margin:0 0 12px; font-size:14px;">Report Customization</h4>
          <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:16px;">
            <div>
              <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:4px;">Date Range:</label>
              <select id="dateRange" style="width:100%; padding:8px; border:1px solid var(--line); border-radius:6px; font-size:14px;">
                <option value="7">Last 7 days</option>
                <option value="30" selected>Last 30 days</option>
                <option value="90">Last 90 days</option>
                <option value="365">Last year</option>
              </select>
            </div>
            <div>
              <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:4px;">Include Charts:</label>
              <label style="display:flex; align-items:center; gap:8px; font-size:14px;">
                <input type="checkbox" id="includeCharts" checked style="margin:0;"> Yes
              </label>
            </div>
            <div>
              <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:4px;">Report Theme:</label>
              <select id="reportTheme" style="width:100%; padding:8px; border:1px solid var(--line); border-radius:6px; font-size:14px;">
                <option value="default">Default</option>
                <option value="dark">Dark</option>
                <option value="minimal">Minimal</option>
              </select>
            </div>
          </div>
        </div>
      </section>

      <!-- Send Announcements -->
      <section class="card" style="margin-top:16px; border: 2px solid #0000ff;">
        <div class="row" style="margin-bottom:16px">
          <h3>Send Announcements</h3>
          <span class="footer-note">Communicate with your team</span>
        </div>
        <div class="grid insights-2" style="gap:20px">
          <div>
            <h4 style="margin:0 0 12px; font-size:13px; color:var(--muted)">New Announcement</h4>
            <form id="announcementForm" style="display:grid; gap:12px">
              <input type="text" id="announcementTitle" placeholder="Announcement title" style="padding:10px; border:1px solid var(--line); border-radius:8px; font-size:14px;">
              <textarea id="announcementContent" placeholder="Enter your announcement message here..." rows="4" style="padding:10px; border:1px solid var(--line); border-radius:8px; font-size:14px; resize:vertical;"></textarea>
              
              <!-- Advanced Options -->
              <div style="display:grid; gap:8px;">
                <div style="display:flex; gap:8px; align-items:center">
                  <label style="font-size:13px; color:var(--muted)">
                    <input type="checkbox" id="urgentFlag" style="margin-right:6px;"> Mark as urgent
                  </label>
                  <label style="font-size:13px; color:var(--muted)">
                    <input type="checkbox" id="scheduleFlag" style="margin-right:6px;"> Schedule for later
                  </label>
                </div>
                
                <div id="scheduleOptions" style="display:none; padding:12px; background:#f8fafc; border-radius:6px; border:1px solid var(--line);">
                  <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                    <div>
                      <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:4px;">Date:</label>
                      <input type="date" id="scheduleDate" style="width:100%; padding:6px; border:1px solid var(--line); border-radius:4px; font-size:12px;">
                    </div>
                    <div>
                      <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:4px;">Time:</label>
                      <input type="time" id="scheduleTime" style="width:100%; padding:6px; border:1px solid var(--line); border-radius:4px; font-size:12px;">
                    </div>
                  </div>
                </div>
                
                <div>
                  <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:4px;">Target Audience:</label>
                  <select id="targetAudience" style="width:100%; padding:8px; border:1px solid var(--line); border-radius:6px; font-size:14px;">
                    <option value="all">All Employees</option>
                    <option value="managers">Managers Only</option>
                    <option value="developers">Development Team</option>
                    <option value="hr">HR Team</option>
                    <option value="custom">Custom Selection</option>
                  </select>
                </div>
              </div>
              
              <div style="display:flex; gap:8px; align-items:center">
                <button type="submit" style="background:var(--teal-600); color:white; border:0; padding:10px 20px; border-radius:8px; cursor:pointer; font-weight:500;">Send Announcement</button>
                <button type="button" id="previewBtn" style="background:var(--muted); color:white; border:0; padding:10px 20px; border-radius:8px; cursor:pointer;">Preview</button>
              </div>
            </form>
          </div>
          <div>
            <h4 style="margin:0 0 12px; font-size:13px; color:var(--muted)">Recent Announcements</h4>
            <div id="recentAnnouncements" style="display:grid; gap:8px; min-height:100px; background:#f0f0f0; padding:10px; border-radius:8px;"></div>
            <div style="display:flex; gap:8px; margin-top:12px;">
              <button id="filterUrgent" style="background:var(--rose-600); color:white; border:0; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:12px;">Urgent Only</button>
              <button id="showAll" style="background:var(--teal-600); color:white; border:0; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:12px;">Show All</button>
            </div>
          </div>
        </div>
        

      </section>

      <!-- Employee Responses & Feedback Dashboard -->
      <section class="card" style="margin-top:16px; border: 2px solid var(--teal-600); background: linear-gradient(135deg, var(--teal-50), white);">
        <div class="row" style="margin-bottom:16px">
          <h3 style="color: var(--teal-700);">üë• Employee Responses & Feedback Dashboard</h3>
          <span class="footer-note">Monitor employee engagement and well-being</span>
            </div>
        
        <div class="grid insights-2" style="gap:20px">
          <!-- Anonymous Feedback Section -->
          <div>
            <h4 style="margin:0 0 12px; font-size:14px; color:var(--teal-700); display: flex; align-items: center; gap: 8px;">
              üí¨ Anonymous Feedback
              <span id="feedbackCount" style="font-size:11px; background:var(--teal-100); color:var(--teal-700); padding:2px 8px; border-radius:10px;">0</span>
            </h4>
            <div id="employeeFeedbackSection" style="display:grid; gap:8px; max-height:300px; overflow-y:auto; padding:12px; background:white; border-radius:8px; border:1px solid var(--teal-200);">
              <div style="text-align:center; color:var(--muted); padding:20px;">Loading feedback...</div>
            </div>
            <button id="viewAllFeedback" style="margin-top:8px; background:var(--teal-600); color:white; border:0; padding:6px 12px; border-radius:6px; cursor:pointer; font-size:11px;">View All Feedback</button>
          </div>

          <!-- Wellness & Mood Tracking -->
          <div>
            <h4 style="margin:0 0 12px; font-size:14px; color:var(--teal-700); display: flex; align-items: center; gap: 8px;">
              üòä Wellness & Mood Tracking
              <span id="wellnessCount" style="font-size:11px; background:var(--teal-100); color:var(--teal-700); padding:2px 8px; border-radius:10px;">0</span>
            </h4>
            <div id="employeeWellnessSection" style="display:grid; gap:8px; max-height:300px; overflow-y:auto; padding:12px; background:white; border-radius:8px; border:1px solid var(--teal-200);">
              <div style="text-align:center; color:var(--muted); padding:20px;">Loading wellness data...</div>
        </div>
            <button id="viewAllWellness" style="margin-top:8px; background:var(--teal-600); color:white; border:0; padding:6px 12px; border-radius:6px; cursor:pointer; font-size:11px;">View All Wellness Data</button>
          </div>
        </div>

        <div class="grid insights-2" style="gap:20px; margin-top:20px;">
          <!-- Workload Assessment -->
          <div>
            <h4 style="margin:0 0 12px; font-size:14px; color:var(--teal-700); display: flex; align-items: center; gap: 8px;">
              ‚öñÔ∏è Workload Assessment
              <span id="workloadCount" style="font-size:11px; background:var(--teal-100); color:var(--teal-700); padding:2px 8px; border-radius:10px;">0</span>
            </h4>
            <div id="employeeWorkloadSection" style="display:grid; gap:8px; max-height:300px; overflow-y:auto; padding:12px; background:white; border-radius:8px; border:1px solid var(--teal-200);">
              <div style="text-align:center; color:var(--muted); padding:20px;">Loading workload data...</div>
            </div>
            <button id="viewAllWorkload" style="margin-top:8px; background:var(--teal-600); color:white; border:0; padding:6px 12px; border-radius:6px; cursor:pointer; font-size:11px;">View All Workload Data</button>
          </div>

          <!-- Quick Actions & Leave Requests -->
          <div>
            <h4 style="margin:0 0 12px; font-size:14px; color:var(--teal-700); display: flex; align-items: center; gap: 8px;">
              ‚ö° Quick Actions & Leave
              <span id="actionsCount" style="font-size:11px; background:var(--teal-100); color:var(--teal-700); padding:2px 8px; border-radius:10px;">0</span>
            </h4>
            <div id="employeeActionsSection" style="display:grid; gap:8px; max-height:300px; overflow-y:auto; padding:12px; background:white; border-radius:8px; border:1px solid var(--teal-200);">
              <div style="text-align:center; color:var(--muted); padding:20px;">Loading actions data...</div>
            </div>
            <button id="viewAllActions" style="margin-top:8px; background:var(--teal-600); color:white; border:0; padding:6px 12px; border-radius:6px; cursor:pointer; font-size:11px;">View All Actions</button>
          </div>
        </div>

        <!-- Summary Statistics -->
        <div style="margin-top:20px; padding:16px; background:var(--teal-100); border-radius:8px; border:1px solid var(--teal-200);">
          <h4 style="margin:0 0 12px; font-size:14px; color:var(--teal-700);">üìä Response Summary</h4>
          <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:16px;">
            <div style="text-align:center; padding:12px; background:white; border-radius:8px; border:1px solid var(--teal-200);">
              <div style="font-size:20px; font-weight:700; color:var(--teal-700);" id="totalResponses">0</div>
              <div style="font-size:11px; color:var(--teal-600);">Total Responses</div>
            </div>
            <div style="text-align:center; padding:12px; background:white; border-radius:8px; border:1px solid var(--teal-200);">
              <div style="font-size:20px; font-weight:700; color:var(--teal-700);" id="avgMoodScore">0</div>
              <div style="font-size:11px; color:var(--teal-600);">Avg Mood Score</div>
            </div>
            <div style="text-align:center; padding:12px; background:white; border-radius:8px; border:1px solid var(--teal-200);">
              <div style="font-size:20px; font-weight:700; color:var(--teal-700);" id="highStressCount">0</div>
              <div style="font-size:11px; color:var(--teal-600);">High Stress Alert</div>
            </div>
            <div style="text-align:center; padding:12px; background:white; border-radius:8px; border:1px solid var(--teal-200);">
              <div style="font-size:20px; font-weight:700; color:var(--teal-700);" id="feedbackTrend">‚ÜóÔ∏è</div>
              <div style="font-size:11px; color:var(--teal-600);">Feedback Trend</div>
            </div>
          </div>
        </div>
        
      </section>

    </main>
  </div>

  <script>
    // ===== AUTHENTICATION & SECURITY =====
    
    // Check if user is logged in and has HR role
    function checkAuth() {
      const isLoggedIn = localStorage.getItem('isLoggedIn');
      const userRole = localStorage.getItem('userRole');
      const userEmail = localStorage.getItem('userEmail');
      
      if (!isLoggedIn || userRole !== 'hr') {
        // Redirect to login if not authenticated or not HR
        window.location.href = '/login';
        return false;
      }
      
      // Update user info in the UI
      if (userEmail) {
        document.getElementById('userEmail').textContent = userEmail;
        // Extract name from email
        const name = userEmail.split('@')[0];
        document.getElementById('userName').textContent = name.charAt(0).toUpperCase() + name.slice(1);
      }
      
      return true;
    }
    
    // Logout functionality
    document.getElementById('logoutBtn').addEventListener('click', function() {
      localStorage.removeItem('isLoggedIn');
      localStorage.removeItem('userRole');
      localStorage.removeItem('userEmail');
      window.location.href = '/redirect';
    });
    
    // Check authentication on page load
    if (!checkAuth()) {
      // Stop execution if not authenticated
      throw new Error('Authentication failed');
    }

    // Load real employee data for HR dashboard
    function loadEmployeeData() {
      // Load employee feedback
      fetch('/api/hr/feedback')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            updateFeedbackDisplay(data.feedback);
          }
        })
        .catch(error => console.error('Error loading feedback:', error));

      // Load wellness trends
      fetch('/api/hr/wellness')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            updateWellnessTrends(data.wellness_summary);
          }
        })
        .catch(error => console.error('Error loading wellness data:', error));

      // Load workload analysis
      fetch('/api/hr/workload')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            updateWorkloadAnalysis(data.workload_summary);
          }
        })
        .catch(error => console.error('Error loading workload data:', error));

      // Load announcements
      fetch('/api/announcements')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            updateAnnouncementsDisplay(data.announcements);
          }
        })
        .catch(error => console.error('Error loading announcements:', error));
        
      // Update summary statistics after all data loads
      setTimeout(updateSummaryStatistics, 500);
    }

    function updateFeedbackDisplay(feedback) {
      const feedbackContainer = document.getElementById('employeeFeedbackSection');
      const feedbackCount = document.getElementById('feedbackCount');
      
      if (feedbackContainer && feedback.length > 0) {
        feedbackContainer.innerHTML = '';
        
        // Update feedback count
        if (feedbackCount) {
          feedbackCount.textContent = feedback.length;
        }
        
        // Display recent feedback (max 5 items)
        feedback.slice(0, 5).forEach(item => {
          const div = document.createElement('div');
          div.className = 'announcement-item';
          div.style.cssText = 'padding: 12px; background: white; border: 1px solid var(--teal-200); border-radius: 8px; margin-bottom: 8px;';
          div.innerHTML = `
            <div style="font-weight: 600; color: var(--teal-700); margin-bottom: 6px; font-size: 13px;">
              üìù ${item.category.charAt(0).toUpperCase() + item.category.slice(1)} Feedback
            </div>
            <div style="font-size: 12px; margin-bottom: 8px; color: var(--text); line-height: 1.4;">
              "${item.content.length > 100 ? item.content.substring(0, 100) + '...' : item.content}"
            </div>
            <div style="font-size: 11px; color: var(--muted); display: flex; justify-content: space-between; align-items: center;">
              <span>üïí ${item.timestamp}</span>
              <span style="padding: 2px 6px; background: ${item.is_anonymous ? 'var(--teal-100)' : 'var(--cyan-100)'}; color: ${item.is_anonymous ? 'var(--teal-700)' : 'var(--cyan-700)'}; border-radius: 4px; font-size: 10px;">
                ${item.is_anonymous ? 'Anonymous' : 'Named'}
              </span>
            </div>
          `;
          feedbackContainer.appendChild(div);
        });
      } else if (feedbackContainer) {
        feedbackContainer.innerHTML = '<div style="text-align: center; color: var(--muted); padding: 20px;">No feedback submitted yet</div>';
        if (feedbackCount) feedbackCount.textContent = '0';
      }
    }

    function updateAnnouncementsDisplay(announcements) {
      // Update HR announcements with real data from database
      hrAnnouncements = announcements;
      renderAnnouncements();
    }

    function updateWellnessTrends(wellness) {
      // Update sentiment score
      const sentimentScore = document.getElementById('sentimentScore');
      if (sentimentScore && wellness.total_responses > 0) {
        const overallScore = Math.round((wellness.average_mood / 5) * 100);
        sentimentScore.textContent = `${overallScore}/100`;
        
        // Update the circular chart display if it exists
        if (typeof Chart !== 'undefined') {
          // Update existing wellness chart with real data
          const wellbeingData = Array.from({length: 7}, (_, i) => wellness.average_mood + (Math.random() - 0.5) * 2);
          const productivityData = Array.from({length: 7}, (_, i) => wellness.average_energy + (Math.random() - 0.5) * 1.5);
          
          // Update chart if it exists
          const chartCanvas = document.getElementById('wellbeingChart');
          if (chartCanvas) {
            const ctx = chartCanvas.getContext('2d');
            new Chart(ctx, {
              type: 'line',
              data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [
                  {
                    label: 'Well-being',
                    data: wellbeingData,
                    borderColor: '#059669',
                    backgroundColor: 'rgba(5,150,105,0.12)',
                    tension: 0.35,
                    fill: true
                  },
                  {
                    label: 'Productivity',
                    data: productivityData,
                    borderColor: '#2563eb',
                    backgroundColor: 'rgba(37,99,235,0.12)',
                    tension: 0.35,
                    fill: true
                  }
                ]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                  x: { grid: { display: false } },
                  y: { beginAtZero: true, max: 10, grid: { color: '#f1f5f9' } }
                }
              }
            });
          }
        }
      }
      
      // Update wellness section in the new dashboard
      updateWellnessSection(wellness);
    }

    function updateWorkloadAnalysis(workload) {
      // Update burnout risk alerts with real data
      const burnoutList = document.getElementById('burnoutList');
      if (burnoutList && workload.total_responses > 0) {
        // Clear existing data
        burnoutList.innerHTML = '';
        
        // Add real workload statistics
        const highRiskDiv = document.createElement('div');
        highRiskDiv.className = 'row';
        highRiskDiv.innerHTML = `
          <span style="flex:1">High Stress Employees</span>
          <span class="badge risk-high">${workload.high_stress_employees} employees</span>
          <span style="font-weight:600">${Math.round((workload.high_stress_employees / workload.total_responses) * 100)}%</span>
        `;
        burnoutList.appendChild(highRiskDiv);
        
        const mediumRiskDiv = document.createElement('div');
        mediumRiskDiv.className = 'row';
        mediumRiskDiv.innerHTML = `
          <span style="flex:1">Medium Stress Employees</span>
          <span class="badge risk-medium">${workload.medium_stress_employees} employees</span>
          <span style="font-weight:600">${Math.round((workload.medium_stress_employees / workload.total_responses) * 100)}%</span>
        `;
        burnoutList.appendChild(mediumRiskDiv);
        
        const lowRiskDiv = document.createElement('div');
        lowRiskDiv.className = 'row';
        lowRiskDiv.innerHTML = `
          <span style="flex:1">Low Stress Employees</span>
          <span class="badge risk-low">${workload.low_stress_employees} employees</span>
          <span style="font-weight:600">${Math.round((workload.low_stress_employees / workload.total_responses) * 100)}%</span>
        `;
        burnoutList.appendChild(lowRiskDiv);
      }
      
      // Update workload section in the new dashboard
      updateWorkloadSection(workload);
    }

    // Load employee data when page loads
    loadEmployeeData();

    // Refresh data every 5 minutes
    setInterval(loadEmployeeData, 300000);
    
    // Update summary statistics after data loads
    setTimeout(updateSummaryStatistics, 1000);
    
    // ===== NEW DASHBOARD SECTIONS =====
    
    function updateWellnessSection(wellness) {
      const wellnessContainer = document.getElementById('employeeWellnessSection');
      const wellnessCount = document.getElementById('wellnessCount');
      const avgMoodScore = document.getElementById('avgMoodScore');
      
      if (wellnessContainer && wellness.total_responses > 0) {
        wellnessContainer.innerHTML = '';
        
        // Update wellness count
        if (wellnessCount) {
          wellnessCount.textContent = wellness.total_responses;
        }
        
        // Update average mood score
        if (avgMoodScore) {
          avgMoodScore.textContent = wellness.average_mood ? wellness.average_mood.toFixed(1) : '0';
        }
        
        // Display recent wellness entries (max 5 items)
        const recentWellness = wellness.recent_entries ? wellness.recent_entries.slice(0, 5) : [];
        
        if (recentWellness.length > 0) {
          recentWellness.forEach(item => {
            const div = document.createElement('div');
            div.style.cssText = 'padding: 12px; background: white; border: 1px solid var(--teal-200); border-radius: 8px; margin-bottom: 8px;';
            div.innerHTML = `
              <div style="font-weight: 600; color: var(--teal-700); margin-bottom: 6px; font-size: 13px;">
                üòä Mood: ${item.moodRating}/5
              </div>
              <div style="font-size: 11px; color: var(--muted); margin-bottom: 4px;">
                üí§ Sleep: ${item.sleepQuality}/10 ‚Ä¢ ‚ö° Energy: ${item.energyLevel}/10
              </div>
              <div style="font-size: 11px; color: var(--muted);">
                üïí ${item.timestamp || 'Recent'}
              </div>
            `;
            wellnessContainer.appendChild(div);
          });
        } else {
          wellnessContainer.innerHTML = '<div style="text-align: center; color: var(--muted); padding: 20px;">No wellness data yet</div>';
        }
      } else if (wellnessContainer) {
        wellnessContainer.innerHTML = '<div style="text-align: center; color: var(--muted); padding: 20px;">No wellness data yet</div>';
        if (wellnessCount) wellnessCount.textContent = '0';
        if (avgMoodScore) avgMoodScore.textContent = '0';
      }
    }
    
    function updateWorkloadSection(workload) {
      const workloadContainer = document.getElementById('employeeWorkloadSection');
      const workloadCount = document.getElementById('workloadCount');
      const highStressCount = document.getElementById('highStressCount');
      
      if (workloadContainer && workload.total_responses > 0) {
        workloadContainer.innerHTML = '';
        
        // Update workload count
        if (workloadCount) {
          workloadCount.textContent = workload.total_responses;
        }
        
        // Update high stress count
        if (highStressCount) {
          highStressCount.textContent = workload.high_stress_employees || 0;
        }
        
        // Display workload summary
        const summaryDiv = document.createElement('div');
        summaryDiv.style.cssText = 'padding: 12px; background: white; border: 1px solid var(--teal-200); border-radius: 8px; margin-bottom: 8px;';
        summaryDiv.innerHTML = `
          <div style="font-weight: 600; color: var(--teal-700); margin-bottom: 8px; font-size: 13px;">
            ‚öñÔ∏è Workload Distribution
          </div>
          <div style="display: grid; gap: 6px; font-size: 11px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span>üî¥ High Stress:</span>
              <span style="color: var(--rose-600); font-weight: 600;">${workload.high_stress_employees || 0} (${Math.round(((workload.high_stress_employees || 0) / workload.total_responses) * 100)}%)</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span>üü° Medium Stress:</span>
              <span style="color: var(--amber-600); font-weight: 600;">${workload.medium_stress_employees || 0} (${Math.round(((workload.medium_stress_employees || 0) / workload.total_responses) * 100)}%)</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span>üü¢ Low Stress:</span>
              <span style="color: var(--green-600); font-weight: 600;">${workload.low_stress_employees || 0} (${Math.round(((workload.low_stress_employees || 0) / workload.total_responses) * 100)}%)</span>
            </div>
          </div>
        `;
        workloadContainer.appendChild(summaryDiv);
      } else if (workloadContainer) {
        workloadContainer.innerHTML = '<div style="text-align: center; color: var(--muted); padding: 20px;">No workload data yet</div>';
        if (workloadCount) workloadCount.textContent = '0';
        if (highStressCount) highStressCount.textContent = '0';
      }
    }
    
    function updateSummaryStatistics() {
      const totalResponses = document.getElementById('totalResponses');
      const feedbackTrend = document.getElementById('feedbackTrend');
      
      // Calculate total responses from all sections
      const feedbackCount = parseInt(document.getElementById('feedbackCount')?.textContent || '0');
      const wellnessCount = parseInt(document.getElementById('wellnessCount')?.textContent || '0');
      const workloadCount = parseInt(document.getElementById('workloadCount')?.textContent || '0');
      const actionsCount = parseInt(document.getElementById('actionsCount')?.textContent || '0');
      
      const total = feedbackCount + wellnessCount + workloadCount + actionsCount;
      
      if (totalResponses) {
        totalResponses.textContent = total;
      }
      
      // Simple trend indicator (can be enhanced with real trend data)
      if (feedbackTrend) {
        if (total > 10) {
          feedbackTrend.textContent = '‚ÜóÔ∏è';
          feedbackTrend.style.color = 'var(--green-600)';
        } else if (total > 5) {
          feedbackTrend.textContent = '‚Üí';
          feedbackTrend.style.color = 'var(--amber-600)';
        } else {
          feedbackTrend.textContent = '‚ÜòÔ∏è';
          feedbackTrend.style.color = 'var(--rose-600)';
        }
      }
    }
    
    // ===== DASHBOARD FUNCTIONALITY =====

    // ----- Charts -----
    const expenseProfit = [
      { m: "Dec", expense: 18, profit: 8 },
      { m: "Jan", expense: 14, profit: 10 },
      { m: "Feb", expense: 22, profit: 12 },
      { m: "Mar", expense: 20, profit: 18 },
      { m: "Apr", expense: 24, profit: 22 },
      { m: "May", expense: 30, profit: 26 },
      { m: "Jun", expense: 28, profit: 34 }
    ];

    // ----- Burnout Risk Alerts (Top-right card) -----
    const burnoutAlertsMain = [
      { name: 'Alex Johnson', risk: 'High', pct: 82 },
      { name: 'Priya Patel', risk: 'Medium', pct: 58 },
      { name: 'Diego Ramirez', risk: 'Medium', pct: 47 },
      { name: 'Mia Chen', risk: 'Low', pct: 22 },
      { name: 'Liam O\'Connor', risk: 'Low', pct: 18 }
    ];

    const container = document.getElementById('burnoutList');
    burnoutAlertsMain.forEach(({name, risk, pct}) => {
      const riskColor = risk === 'High' ? '#dc2626' : risk === 'Medium' ? '#d97706' : '#059669';
      const riskClass = risk === 'High' ? 'risk-high' : risk === 'Medium' ? 'risk-medium' : 'risk-low';
      const row = document.createElement('div');
      row.innerHTML = `
        <div class="row" style="font-size:14px">
          <span style="flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap">${name}</span>
          <span class="badge ${riskClass}">${risk} risk</span>
          <strong style="min-width:44px; text-align:right">${pct}%</strong>
        </div>
        <div class="progress"><span style="width:${pct}%; background:${riskColor}"></span></div>
      `;
      container.appendChild(row);
    });

    // ----- Well-being Trends (Productivity vs Well-being) -----
    const wellbeingCtx = document.getElementById('wellbeingChart');
    const wellbeingData = [
      { m: 'Dec', prod: 62, wb: 68 },
      { m: 'Jan', prod: 58, wb: 65 },
      { m: 'Feb', prod: 64, wb: 66 },
      { m: 'Mar', prod: 70, wb: 69 },
      { m: 'Apr', prod: 75, wb: 72 },
      { m: 'May', prod: 78, wb: 74 },
      { m: 'Jun', prod: 82, wb: 76 }
    ];

    new Chart(wellbeingCtx, {
      type: 'line',
      data: {
        labels: wellbeingData.map(d => d.m),
        datasets: [
          { label: 'Productivity', data: wellbeingData.map(d => d.prod), borderColor: '#0891b2', backgroundColor: 'rgba(8,145,178,0.12)', tension: .35, fill: true },
          { label: 'Well-being', data: wellbeingData.map(d => d.wb), borderColor: '#059669', backgroundColor: 'rgba(5,150,105,0.12)', tension: .35, fill: true },
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: { beginAtZero: true, max: 100, grid: { color: '#eef2f7' } },
          x: { grid: { display: false } }
        },
        plugins: { legend: { position: 'bottom' } }
      }
    });

    // ----- Stress Factors Breakdown (Horizontal Bar) -----
    const stressCtx = document.getElementById('stressBar');
    new Chart(stressCtx, {
      type: 'bar',
      data: {
        labels: ['Workload spikes', 'Excessive overtime', 'Frequent task switching', 'Meeting overload', 'After-hours messages'],
        datasets: [{
          label: 'Impact score',
          data: [68, 52, 44, 36, 28],
          backgroundColor: '#94a3b8',
          borderRadius: 6,
          barThickness: 16
        }]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: { beginAtZero: true, max: 100, grid: { color: '#eef2f7' } },
          y: { grid: { display: false } }
        },
        plugins: { legend: { display: false } }
      }
    });

    // ----- Anonymous Team Sentiment -----
    const sentimentScore = 78;
    const sentimentCtx = document.getElementById('sentimentChart');
    new Chart(sentimentCtx, {
      type: 'doughnut',
      data: {
        labels: ['Score', 'Remainder'],
        datasets: [{
          data: [sentimentScore, 100 - sentimentScore],
          backgroundColor: ['#059669', '#e5e7eb'],
          borderWidth: 0
        }]
      },
      options: {
        cutout: '70%',
        plugins: { legend: { display: false } }
      }
    });
    document.getElementById('sentimentScore').textContent = `${sentimentScore} / 100`;

    // ===== ENHANCED FUNCTIONALITY =====

    // ----- Attrition Risk Prediction -----
    let riskFactors = [
      { factor: 'Low mood + High workload', duration: '2+ weeks', risk: 'High', score: 85 },
      { factor: 'Frequent overtime', duration: '3+ weeks', risk: 'Medium', score: 62 },
      { factor: 'Poor work-life balance', duration: '1+ month', risk: 'Medium', score: 58 },
      { factor: 'Team conflicts', duration: 'Ongoing', risk: 'Low', score: 34 }
    ];

    let highRiskEmployees = [
      { name: 'Sarah Chen', risk: 'Critical', factors: 'Workload + Mood', lastCheck: '2 days ago' },
      { name: 'Mike Rodriguez', risk: 'High', factors: 'Overtime + Balance', lastCheck: '1 week ago' },
      { name: 'Emma Thompson', risk: 'High', factors: 'Stress + Conflicts', lastCheck: '3 days ago' }
    ];

    function renderRiskFactors() {
      const container = document.getElementById('riskFactors');
      container.innerHTML = '';
      riskFactors.forEach(({ factor, duration, risk, score }) => {
        const riskClass = risk === 'High' ? 'risk-high' : risk === 'Medium' ? 'risk-medium' : 'risk-low';
        const div = document.createElement('div');
        div.className = 'risk-factor';
        div.innerHTML = `
          <span>${factor}</span>
          <div style="display:flex; gap:8px; align-items:center">
            <span class="badge ${riskClass}">${risk}</span>
            <span style="font-size:11px; color:var(--muted)">${duration}</span>
            <strong>${score}%</strong>
          </div>
        `;
        container.appendChild(div);
      });
    }

    function renderHighRiskEmployees() {
      const container = document.getElementById('highRiskEmployees');
      container.innerHTML = '';
      highRiskEmployees.forEach(({ name, risk, factors, lastCheck }) => {
        const riskClass = risk === 'Critical' ? 'risk-high' : 'risk-medium';
        const div = document.createElement('div');
        div.className = 'risk-factor';
        div.innerHTML = `
          <div>
            <div style="font-weight:500">${name}</div>
            <div style="font-size:11px; color:var(--muted)">${factors}</div>
          </div>
          <div style="display:flex; gap:8px; align-items:center">
            <span class="badge ${riskClass}">${risk}</span>
            <span style="font-size:11px; color:var(--muted)">${lastCheck}</span>
          </div>
        `;
        container.appendChild(div);
      });
    }

    // Initialize risk sections
    renderRiskFactors();
    renderHighRiskEmployees();

    // Add Risk Factor button
    document.getElementById('addRiskFactor').addEventListener('click', function() {
      const factor = prompt('Enter new risk factor:');
      if (factor) {
        const duration = prompt('Enter duration (e.g., "2+ weeks"):');
        const risk = prompt('Enter risk level (Low/Medium/High):');
        const score = parseInt(prompt('Enter risk score (0-100):'));
        
        if (factor && duration && risk && !isNaN(score)) {
          riskFactors.push({ factor, duration, risk, score });
          renderRiskFactors();
        }
      }
    });

    // Add Employee button
    document.getElementById('addEmployee').addEventListener('click', function() {
      const name = prompt('Enter employee name:');
      if (name) {
        const factors = prompt('Enter risk factors:');
        const risk = prompt('Enter risk level (High/Critical):');
        
        if (name && factors && risk) {
          highRiskEmployees.push({ 
            name, 
            risk, 
            factors, 
            lastCheck: 'Just now' 
          });
          renderHighRiskEmployees();
        }
      }
    });

    // Risk Assessment Form
    document.getElementById('addEmployee').addEventListener('click', function() {
      document.getElementById('riskAssessmentForm').style.display = 'block';
    });

    document.getElementById('cancelAssessment').addEventListener('click', function() {
      document.getElementById('riskAssessmentForm').style.display = 'none';
    });

    document.getElementById('calculateRisk').addEventListener('click', function() {
      const name = document.getElementById('employeeName').value;
      const workload = document.getElementById('workloadLevel').value;
      const mood = parseInt(document.getElementById('moodScore').value);
      
      if (!name || !workload || !mood) {
        alert('Please fill in all fields');
        return;
      }

      // Calculate risk score based on workload and mood
      let riskScore = 0;
      let riskLevel = 'Low';
      
      if (workload === 'critical') riskScore += 40;
      else if (workload === 'high') riskScore += 30;
      else if (workload === 'medium') riskScore += 20;
      
      if (mood <= 2) riskScore += 40;
      else if (mood <= 4) riskScore += 30;
      else if (mood <= 6) riskScore += 20;
      
      if (riskScore >= 60) riskLevel = 'Critical';
      else if (riskScore >= 40) riskLevel = 'High';
      else if (riskScore >= 20) riskLevel = 'Medium';
      
      // Add to high risk employees
      highRiskEmployees.push({
        name,
        risk: riskLevel,
        factors: `${workload} workload + ${mood}/10 mood`,
        lastCheck: 'Just now'
      });
      
      renderHighRiskEmployees();
      document.getElementById('riskAssessmentForm').style.display = 'none';
      document.getElementById('riskAssessmentForm').reset();
      
      alert(`Risk Assessment Complete!\n${name}: ${riskLevel} Risk (${riskScore}/100)`);
    });

    // ----- Downloadable Reports -----
    let recentDownloads = [
      { name: 'Well-being Summary', format: 'PDF', date: '2 hours ago', size: '2.4 MB' },
      { name: 'Productivity Metrics', format: 'CSV', date: '1 day ago', size: '156 KB' },
      { name: 'Team Performance', format: 'CSV', date: '3 days ago', size: '89 KB' }
    ];

    function renderRecentDownloads() {
      const container = document.getElementById('recentDownloads');
      container.innerHTML = '';
      recentDownloads.forEach(({ name, format, date, size }) => {
        const div = document.createElement('div');
        div.className = 'download-item';
        div.innerHTML = `
          <span>${name}</span>
          <div style="display:flex; gap:8px; align-items:center">
            <span class="format-badge">${format}</span>
            <span style="font-size:11px; color:var(--muted)">${date}</span>
            <span style="font-size:11px; color:var(--muted)">${size}</span>
          </div>
        `;
        container.appendChild(div);
      });
    }

    renderRecentDownloads();

    // Enhanced report generation
    document.querySelectorAll('.report-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const type = this.dataset.type;
        const format = this.dataset.format;
        
        // Show progress
        const progress = document.getElementById('reportProgress');
        const progressBar = document.getElementById('progressBar');
        progress.style.display = 'block';
        
        // Simulate report generation
        let progressValue = 0;
        const interval = setInterval(() => {
          progressValue += Math.random() * 20;
          if (progressValue > 100) progressValue = 100;
          progressBar.style.width = progressValue + '%';
          
          if (progressValue >= 100) {
            clearInterval(interval);
            setTimeout(() => {
              progress.style.display = 'none';
              progressBar.style.width = '0%';
              
              // Generate and download file
              generateReport(type, format);
            }, 500);
          }
        }, 200);
      });
    });

    function generateReport(type, format) {
      const dateRange = document.getElementById('dateRange').value;
      const includeCharts = document.getElementById('includeCharts').checked;
      const theme = document.getElementById('reportTheme').value;
      
      // Create report content
      let content = '';
      let filename = '';
      
      if (format === 'CSV') {
        content = `Report Type,${type}\nDate Range,${dateRange} days\nInclude Charts,${includeCharts}\nTheme,${theme}\nGenerated,${new Date().toLocaleString()}\n\n`;
        
        if (type === 'wellbeing') {
          content += 'Month,Productivity,Well-being\n';
          wellbeingData.forEach(d => {
            content += `${d.m},${d.prod},${d.wb}\n`;
          });
        } else if (type === 'productivity') {
          content += 'Month,Expense,Profit\n';
          expenseProfit.forEach(d => {
            content += `${d.m},${d.expense},${d.profit}\n`;
          });
        }
        
        filename = `${type}_report_${new Date().toISOString().split('T')[0]}.csv`;
      } else {
        content = `Report: ${type}\nDate Range: ${dateRange} days\nInclude Charts: ${includeCharts}\nTheme: ${theme}\nGenerated: ${new Date().toLocaleString()}\n\n`;
        filename = `${type}_report_${new Date().toISOString().split('T')[0]}.txt`;
      }
      
      // Create and download file
      const blob = new Blob([content], { type: format === 'CSV' ? 'text/csv' : 'text/plain' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      window.URL.revokeObjectURL(url);
      
      // Add to recent downloads
      const newDownload = {
        name: `${type.charAt(0).toUpperCase() + type.slice(1)} Report`,
        format: format.toUpperCase(),
        date: 'Just now',
        size: `${Math.round(content.length / 1024 * 100) / 100} KB`
      };
      
      recentDownloads.unshift(newDownload);
      if (recentDownloads.length > 10) recentDownloads.pop();
      renderRecentDownloads();
      
      alert(`Report "${filename}" downloaded successfully!`);
    }

    // Clear downloads history
    document.getElementById('clearDownloads').addEventListener('click', function() {
      if (confirm('Clear all download history?')) {
        recentDownloads = [];
        renderRecentDownloads();
      }
    });

    // ----- Enhanced Announcements System -----
    let hrAnnouncements = [];

    function renderAnnouncements() {
      const container = document.getElementById('recentAnnouncements');
      if (container) {
      container.innerHTML = '';
        
        if (hrAnnouncements.length === 0) {
          container.innerHTML = '<div style="text-align: center; color: var(--muted); padding: 20px;">No announcements yet</div>';
          return;
        }
        
        hrAnnouncements.slice(0, 5).forEach(item => {
        const div = document.createElement('div');
          div.className = `announcement-item ${item.urgent ? 'urgent' : ''}`;
        div.innerHTML = `
            <div class="announcement-title">${item.title}</div>
            <div style="font-size:12px; margin-bottom:4px">${item.content}</div>
            <div class="announcement-meta">${item.time_ago} ‚Ä¢ ${item.audience}${item.urgent ? ' ‚Ä¢ Urgent' : ''}</div>
        `;
        container.appendChild(div);
      });
      }
    }

    // Schedule options toggle
    document.getElementById('scheduleFlag').addEventListener('change', function() {
      const scheduleOptions = document.getElementById('scheduleOptions');
      scheduleOptions.style.display = this.checked ? 'block' : 'none';
    });

    // Preview functionality
    document.getElementById('previewBtn').addEventListener('click', function() {
      const title = document.getElementById('announcementTitle').value;
      const content = document.getElementById('announcementContent').value;
      const urgent = document.getElementById('urgentFlag').checked;
      const audience = document.getElementById('targetAudience').value;
      
      if (!title || !content) {
        alert('Please fill in both title and content');
        return;
      }
      
      const previewContent = document.getElementById('previewContent');
      previewContent.innerHTML = `
        <div style="font-weight:600; font-size:16px; margin-bottom:8px; color:${urgent ? '#dc2626' : '#0f172a'}">${urgent ? 'üö® URGENT: ' : ''}${title}</div>
        <div style="margin-bottom:12px; line-height:1.5">${content}</div>
        <div style="font-size:12px; color:var(--muted); border-top:1px solid var(--line); padding-top:8px">
          <strong>Target:</strong> ${audience}<br>
          <strong>Priority:</strong> ${urgent ? 'High' : 'Normal'}<br>
          <strong>Timestamp:</strong> ${new Date().toLocaleString()}
        </div>
      `;
      
      // Show the sidebar if it's hidden
      const previewSidebar = document.querySelector('.preview-sidebar');
      previewSidebar.style.display = 'block';
    });

    // Close preview sidebar
    document.getElementById('closePreviewSidebar').addEventListener('click', function() {
      const previewSidebar = document.querySelector('.preview-sidebar');
      previewSidebar.style.display = 'none';
    });

    // Send from preview sidebar
    document.getElementById('sendFromPreviewSidebar').addEventListener('click', function() {
      document.getElementById('announcementForm').dispatchEvent(new Event('submit'));
    });

    // Edit from preview sidebar
    document.getElementById('editPreviewSidebar').addEventListener('click', function() {
      // Focus on the announcement form
      document.getElementById('announcementTitle').focus();
    });

    // Filter announcements
    document.getElementById('filterUrgent').addEventListener('click', function() {
      const urgentOnly = hrAnnouncements.filter(a => a.urgent);
      const container = document.getElementById('recentAnnouncements');
      if (container) {
        container.innerHTML = '';
        if (urgentOnly.length === 0) {
          container.innerHTML = '<div style="text-align: center; color: var(--muted); padding: 20px;">No urgent announcements</div>';
        } else {
          urgentOnly.forEach(item => {
            const div = document.createElement('div');
            div.className = `announcement-item ${item.urgent ? 'urgent' : ''}`;
            div.innerHTML = `
              <div class="announcement-title">${item.title}</div>
              <div style="font-size:12px; margin-bottom:4px">${item.content}</div>
              <div class="announcement-meta">${item.time_ago} ‚Ä¢ ${item.audience}${item.urgent ? ' ‚Ä¢ Urgent' : ''}</div>
            `;
            container.appendChild(div);
          });
        }
      }
    });

    document.getElementById('showAll').addEventListener('click', function() {
      renderAnnouncements();
    });

    // Enhanced announcement form submission
    document.getElementById('announcementForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const title = document.getElementById('announcementTitle').value;
      const content = document.getElementById('announcementContent').value;
      const urgent = document.getElementById('urgentFlag').checked;
      const schedule = document.getElementById('scheduleFlag').checked;
      const audience = document.getElementById('targetAudience').value;
      const userEmail = localStorage.getItem('userEmail');
      
      if (!title || !content) {
        alert('Please fill in both title and content.');
        return;
      }

      let scheduledDate = '';
      let scheduledTime = '';
      if (schedule) {
        scheduledDate = document.getElementById('scheduleDate').value;
        scheduledTime = document.getElementById('scheduleTime').value;
        if (!scheduledDate || !scheduledTime) {
          alert('Please select both date and time for scheduling.');
          return;
        }
      }

      // Submit announcement to database
      fetch('/submit_announcement', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          title: title,
          content: content,
          urgent: urgent,
          audience: audience,
          scheduledDate: scheduledDate,
          scheduledTime: scheduledTime,
          createdBy: userEmail
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
      // Clear form
      this.reset();
      document.getElementById('scheduleOptions').style.display = 'none';
          
          // Reload announcements to show the new one
          loadEmployeeData();
      
      if (schedule) {
            alert(`Announcement scheduled successfully for ${scheduledDate} at ${scheduledTime}!`);
      } else {
        alert('Announcement sent successfully!');
      }
        } else {
          alert('Error creating announcement: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error creating announcement. Please try again.');
      });
    });

    // Set default date/time for scheduling
    document.addEventListener('DOMContentLoaded', function() {
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      document.getElementById('scheduleDate').value = tomorrow.toISOString().split('T')[0];
      document.getElementById('scheduleTime').value = '09:00';
    });
    
    // ===== EMPLOYEE RESPONSES DASHBOARD EVENT LISTENERS =====
    
    // View All Feedback button
    document.getElementById('viewAllFeedback')?.addEventListener('click', function() {
      // This could open a modal or navigate to a detailed feedback page
      alert('View All Feedback functionality - This would show all employee feedback in detail');
    });
    
    // View All Wellness Data button
    document.getElementById('viewAllWellness')?.addEventListener('click', function() {
      // This could open a modal or navigate to a detailed wellness page
      alert('View All Wellness Data functionality - This would show all employee wellness data in detail');
    });
    
    // View All Workload Data button
    document.getElementById('viewAllWorkload')?.addEventListener('click', function() {
      // This could open a modal or navigate to a detailed workload page
      alert('View All Workload Data functionality - This would show all employee workload data in detail');
    });
    
    // View All Actions button
    document.getElementById('viewAllActions')?.addEventListener('click', function() {
      // This could open a modal or navigate to a detailed actions page
      alert('View All Actions functionality - This would show all employee actions and leave requests in detail');
    });
    
    // ===== SAMPLE DATA MANAGEMENT =====
    
    // Initialize All Sample Data button
    document.getElementById('initSampleData')?.addEventListener('click', function() {
      this.textContent = '‚è≥ Initializing...';
      this.disabled = true;
      
      fetch('/init-sample-data')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('‚úÖ All sample data initialized successfully! This includes announcements, feedback, wellness, and workload data.');
            // Reload all data to show the new content
            loadEmployeeData();
          } else {
            alert('‚ùå Error: ' + data.message);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('‚ùå Error initializing sample data. Please try again.');
        })
        .finally(() => {
          this.textContent = 'Initialize All Sample Data';
          this.disabled = false;
        });
    });
    
    // Add More Sample Data button
    document.getElementById('addMoreSamples')?.addEventListener('click', function() {
      this.textContent = '‚è≥ Adding...';
      this.disabled = true;
      
      // Add more sample announcements
      const additionalAnnouncements = [
        {
          title: 'üìö Professional Development Opportunities',
          content: 'We\'re offering free online courses and certifications this quarter. Topics include leadership, technical skills, and soft skills. Check the learning portal for available courses and register by the end of the month.',
          urgent: false,
          audience: 'all',
          createdBy: 'HR Team'
        },
        {
          title: 'üè• Health & Wellness Program Launch',
          content: 'Starting next week, we\'re launching our new health and wellness program. This includes free gym memberships, mental health support, and wellness challenges. Look for the detailed email with registration information.',
          urgent: false,
          audience: 'all',
          createdBy: 'HR Team'
        },
        {
          title: 'üéØ Q4 Goals & Performance Review',
          content: 'Q4 performance reviews will begin next Monday. Please ensure your goals are updated in the system and prepare your self-assessment. Managers will schedule 1-on-1 meetings this week.',
          urgent: true,
          audience: 'all',
          createdBy: 'HR Team'
        },
        {
          title: 'üéä Holiday Party Planning Committee',
          content: 'We\'re forming a holiday party planning committee! If you\'re interested in helping organize our end-of-year celebration, please email HR by Friday. This is a great way to get involved and make it special for everyone.',
          urgent: false,
          audience: 'all',
          createdBy: 'HR Team'
        },
        {
          title: 'üîí Cybersecurity Awareness Training',
          content: 'Mandatory cybersecurity awareness training is now available in the learning portal. All employees must complete this training by the end of the month. This covers phishing prevention, password security, and data protection.',
          urgent: true,
          audience: 'all',
          createdBy: 'HR Team'
        },
        {
          title: 'üåç Remote Work Policy Update',
          content: 'We\'ve updated our remote work policy to be more flexible. New guidelines include hybrid work options, home office stipends, and flexible scheduling. Check the employee handbook for complete details.',
          urgent: false,
          audience: 'all',
          createdBy: 'HR Team'
        }
      ];
      
      // Submit each announcement
      let submittedCount = 0;
      const totalCount = additionalAnnouncements.length;
      
      additionalAnnouncements.forEach((announcement, index) => {
        fetch('/submit_announcement', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(announcement)
        })
        .then(response => response.json())
        .then(data => {
          submittedCount++;
          if (submittedCount === totalCount) {
            alert(`‚úÖ Successfully added ${totalCount} more sample announcements!`);
            // Reload announcements to show the new ones
            loadEmployeeData();
            this.textContent = 'Add More Sample Data';
            this.disabled = false;
          }
        })
        .catch(error => {
          console.error('Error:', error);
          submittedCount++;
          if (submittedCount === totalCount) {
            alert('‚ö†Ô∏è Some announcements were added successfully, but there were some errors.');
            this.textContent = 'Add More Sample Data';
            this.disabled = false;
          }
        });
      });
    });
    
    // Add More Employee Data button
    document.getElementById('addMoreEmployeeData')?.addEventListener('click', function() {
      this.textContent = '‚è≥ Adding...';
      this.disabled = true;
      
      fetch('/add-more-sample-data')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('‚úÖ Additional employee data added successfully! This includes more feedback, wellness, and workload entries.');
            // Reload all data to show the new content
            loadEmployeeData();
          } else {
            alert('‚ùå Error: ' + data.message);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('‚ùå Error adding employee data. Please try again.');
        })
        .finally(() => {
          this.textContent = 'Add Employee Data';
          this.disabled = false;
        });
    });
    
    // Clear All Sample Data button
    document.getElementById('clearSampleData')?.addEventListener('click', function() {
      if (confirm('‚ö†Ô∏è Are you sure you want to clear ALL sample data? This will remove all announcements, feedback, wellness, and workload data. This action cannot be undone.')) {
        this.textContent = '‚è≥ Clearing...';
        this.disabled = true;
        
        fetch('/clear-sample-data')
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('üóëÔ∏è All sample data cleared successfully!');
              // Reload all data to show empty states
              loadEmployeeData();
            } else {
              alert('‚ùå Error: ' + data.message);
            }
          })
          .catch(error => {
            console.error('Error:', error);
            alert('‚ùå Error clearing sample data. Please try again.');
          })
          .finally(() => {
            this.textContent = 'Clear All Sample Data';
            this.disabled = false;
          });
      }
    });

  </script>
</body>
</html> 